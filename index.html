<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Training Hub</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            background-color: #f9f9f9;
            margin: 0;
            padding: 20px;
        }
        h1 {
            text-align: center;
        }
        p {
            text-align: center;
        }
        table {
            width: 100%;
            max-width: 800px;
            margin: 20px auto;
            border-collapse: collapse;
        }
        th, td {
            border: 1px solid #ddd;
            padding: 8px;
            text-align: center;
        }
        th {
            background-color: #ff8000;
            color: white;
            border-radius: 5px;
        }
        tr:nth-child(even) {
            background-color: #f2f2f2;
        }
        input[type="text"] {
            width: 90%;
            padding: 5px;
        }
        button {
            padding: 5px 10px;
            border: none;
            background-color: #125fca;
            color: white;
            cursor: pointer;
            font-size: 16px;
            border-radius: 5px;
        }
        button:disabled {
            background-color: #ccc;
            cursor: not-allowed;
        }
        .sticker {
            width: 50px;
            display: none;
        }
    </style>
</head>
<body>

    <h1>Team Training Tracker</h1>
    <p>Grab yourself an Alias and record your development progress below. You'll find resources on the next page.</p>
    <a href="trailmixes.html" style="display: block; text-align: center; margin-top: 20px; color: #ff8000; text-decoration: none; font-weight: bold;">Go to Training Resources</a>
    <a href="progress.html" style="display: block; text-align: center; margin-top: 20px; color: #ff8000; text-decoration: none; font-weight: bold;">Go to Our Progress</a>

    <table>
        <thead>
            <tr>
                <th>Alias</th>
                <th>Course Name</th>
                <th>Course Details</th>
                <th>Complete</th>
                <th>Sticker</th>
            </tr>
        </thead>
        <tbody id="trainingTable">
            <tr data-index="1">
                <td><input type="text" id="alias1" placeholder="Alias 1"></td>
                <td><input type="text" id="course1" placeholder="Course Name"></td>
                <td><input type="text" id="details1" placeholder="Course Details"></td>
                <td><button onclick="completeTask(this, 1)">Complete</button></td>
                <td><img class="sticker" src="https://media.giphy.com/media/YTbZzCkRQCEJa/giphy.gif" alt="sticker"></td>
            </tr>
            <!-- Add more rows as needed -->
        </tbody>
    </table>

    <script>
    onst SHEET_URL = "https://script.google.com/macros/s/AKfycbxeTIkZbdvR2UJDxBuClUmQnegWRrWaHTS0gaMc67NvbfgTxTJUQfjxzf0DoTBe2l4h/exec"; // Replace with your Google Apps Script Web App URL
    document.addEventListener('DOMContentLoaded', function () {
        loadSavedValues();

        // Save input values to Google Sheets when they change
        document.querySelectorAll('input[type="text"]').forEach(input => {
            input.addEventListener('input', function () {
                const row = parseInt(this.closest('tr').getAttribute('data-index')) + 1;
                const col = getColumnIndex(this.id);
                const value = this.value;

                // Save to Google Sheets
                updateSheet(row, col, value);
            });
        });
    });

    function loadSavedValues() {
        fetch(SHEET_URL)
            .then(response => response.json())
            .then(data => {
                data.forEach((row, index) => {
                    if (index === 0) return; // Skip headers

                    // Set values for inputs based on row data
                    document.getElementById(`alias${index}`).value = row[0];
                    document.getElementById(`course${index}`).value = row[1];
                    document.getElementById(`details${index}`).value = row[2];

                    // Set completion status
                    if (row[3] === "true") {
                        const button = document.querySelector(`tr[data-index="${index - 1}"] button`);
                        const sticker = document.querySelector(`tr[data-index="${index - 1}"] .sticker`);
                        button.disabled = true;
                        sticker.style.display = 'block';
                    }
                });
            }).catch(err => {
                console.error("Error loading data: ", err);
            });
    }

    function getColumnIndex(id) {
        if (id.includes('alias')) return 1;
        if (id.includes('course')) return 2;
        if (id.includes('details')) return 3;
        return 0;
    }

    function updateSheet(row, col, value) {
        const postData = {
            row: row,
            col: col,
            value: value
        };

        fetch(SHEET_URL, {
            method: 'POST',
            body: JSON.stringify(postData),
            headers: {
                'Content-Type': 'application/json'
            }
        }).then(response => response.text()).then(data => {
            console.log("Update Success: ", data);
        }).catch(err => {
            console.error("Error updating sheet: ", err);
            alert("Failed to save data. Please check your internet connection.");
        });
    }

    function completeTask(button, index) {
        let row = parseInt(index) + 1;
        let sticker = button.parentElement.parentElement.querySelector('.sticker');

        if (!button.disabled) {
            // Mark the task as complete
            button.disabled = true;
            sticker.style.display = 'block';

            // Save completion status to Google Sheets
            updateSheet(row, 4, 'true'); // Column 4 is 'Complete' status
        }
    }
    </script>

</body>
</html>
